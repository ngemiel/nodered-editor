<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Drag & Drop Node-RED Editor @ngemiel</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/reactflow@11/dist/umd/ReactFlow.umd.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/reactflow@11/dist/style.css">
  <style>
    body { margin: 0; font-family: Arial; background: #f5f5f5; }
    #toolbar { padding: 10px; background: #d32f2f; color: white; text-align: center; }
    button { margin: 5px; padding: 8px 15px; background: white; color: #d32f2f; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #f0f0f0; }
    #root { height: 80vh; }
  </style>
</head>
<body>
  <div id="toolbar">
    <h2>NodeRED Drag & Drop Editor @ngemiel</h2>
    <button onclick="addNode('input')">+ Input Node</button>
    <button onclick="addNode('function')">+ Function Node</button>
    <button onclick="addNode('output')">+ Output Node</button>
    <button onclick="saveFlow()">üíæ Simpan Flow</button>
    <button onclick="loadFlow()">üîÑ Muat Flow</button>
    <a href="/" style="color: white; text-decoration: underline;">‚Üê Kembali ke JSON Editor</a>
  </div>
  <div id="root"></div>

  <script type="text/babel">
    const { useCallback } = React;
    const { ReactFlow, MiniMap, Controls, Background, addEdge, useNodesState, useEdgesState } = window.ReactFlow;

    const initialNodes = JSON.parse(localStorage.getItem('nodes') || '[]');
    const initialEdges = JSON.parse(localStorage.getItem('edges') || '[]');

    const App = () => {
      const [nodes, setNodes, onNodesChange] = useNodesState(initialNodes);
      const [edges, setEdges, onEdgesChange] = useEdgesState(initialEdges);

      const onConnect = useCallback((params) => setEdges((eds) => addEdge(params, eds)), [setEdges]);

      const addNode = (type) => {
        const newNode = {
          id: Date.now().toString(),
          type: 'default',
          position: { x: Math.random() * 400, y: Math.random() * 300 },
          data: { label: `${type.charAt(0).toUpperCase() + type.slice(1)} Node` },
          style: { 
            background: type === 'input' ? '#90EE90' : type === 'output' ? '#FFB6C1' : '#ADD8E6',
            padding: 10, borderRadius: 5 
          },
        };
        setNodes((nds) => nds.concat(newNode));
      };

      const saveFlow = () => {
        localStorage.setItem('nodes', JSON.stringify(nodes));
        localStorage.setItem('edges', JSON.stringify(edges));
        alert('Flow tersimpan di browser!');
      };

      const loadFlow = () => location.reload();

      return (
        <ReactFlow
          nodes={nodes}
          edges={edges}
          onNodesChange={onNodesChange}
          onEdgesChange={onEdgesChange}
          onConnect={onConnect}
          fitView
        >
          <MiniMap />
          <Controls />
          <Background />
        </ReactFlow>
      );
    };

    window.addNode = addNode;
    window.saveFlow = saveFlow;
    window.loadFlow = loadFlow;

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
